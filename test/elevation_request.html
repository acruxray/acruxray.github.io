<html>
<head>
	<title></title>
	<style>
		html{
			font-size: 14px;
		}

		body{
			background: #f5f5f5;
		}

		#map{
			/*height:26rem;*/
			height:50%;
			/*height:52rem;*/
			width: 100%;
			/*width: 100%;*/
			margin:2rem auto;
		}


		.marker-gmm-forecast{
			background: #0277bd;
			cursor: pointer;
			height: 40px;
			width: 40px;
			box-sizing:border-box;
			border-radius: 50%;
			padding: 10px;
			margin-left: -10px;
			text-align: center;
		}

	</style>

	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD1AYcI4y4vo8YxagQGsqGX-bjSIRj0yYU"></script>

</head>
<body>

<!-- <script src="customMarker.js"></script> -->


<div id="map"></div>





<script>





function print_r(arr, level) {
    var print_red_text = "";
    if(!level) level = 0;
    var level_padding = "";
    for(var j=0; j<level+1; j++) level_padding += "    ";
    if(typeof(arr) == 'object') {
        for(var item in arr) {
            var value = arr[item];
            if(typeof(value) == 'object') {
                print_red_text += level_padding + "'" + item + "' :\n";
                print_red_text += print_r(value,level+1);
		} 
            else 
                print_red_text += level_padding + "'" + item + "' => \"" + value + "\"\n";
        }
    } 

    else  print_red_text = "===>"+arr+"<===("+typeof(arr)+")";
    return print_red_text;
}




function deg2rad(angle){
	return angle * 0.017453292519943295; // (angle/180)*Math.PI
}

function lengthLonInKm(lat){
	return Math.cos(deg2rad(Math.round(lat))) * 111.153;
}


/* ------------------------------------------------------------------------------ */

// alert(Math.round(5.45674))
// var lat=49.998;
// var lon=23.005;

function coordsCalculate(lat,lon){

	var a=[0,60,120,180,240,300];	//azimuts
	// var a=[0,45,90,135,180,225,270,315];	//azimuts
	// var d=[0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1,1.2,1.4,1.6,1.8,2,2.33,2.66,3,3.5,4];	//distance in km
	var d=[0.1,0.2,0.4,0.8,1.6,3.2,6.4,12.8,25.6,51.2,102.4,204.8,409.6,819.2,1638.4,3276.8];	//distance in km

	// var zoomScaleControl={
	// 	19:0.1,
	// 	18:0.1,
	// 	17:0.1,
	// 	16:0.2,
	// 	15:0.4,
	// 	14:0.8,
	// 	13:1.6,
	// 	12:3.2,
	// 	11:6.4,
	// 	10:12.8,
	// 	9:25.6,
	// 	8:51.2,
	// 	7:102.4,
	// 	6:204.8,
	// 	5:409.6,
	// 	4:819.2,
	// 	3:1638.4,
	// 	2:3276.8
	// };



	/*
	zoom 21: --/--
	zoom 20: --/--
	zoom 19: 0.1
	zoom 18: 0.1
	zoom 17: 0.1
	zoom 16: 0.2
	zoom 15: 0.4
	zoom 14: 0.8
	zoom 13: 1.6
	zoom 12: 3.2
	zoom 11: 6.4
	zoom 10: 12.8
	zoom  9: 25.6
	zoom  8: 51.2
	zoom  7: 102.4
	zoom  6: 204.8
	zoom  5: 409.6
	zoom  4: 819.2
	zoom  3: 1638.4
	zoom  2: 3276.8
	zoom  1: --/--
	zoom  0: --/--
	*/

	var direct=[];
	var locations='';

	var lengthLonKm=lengthLonInKm(lat);

	for (var i=0; i < a.length; i++) {

		if(a[i]>=0&&a[i]<90){
			var ag=90-a[i];
			var pox=1;
			var poy=1;
			}
		if(a[i]>=270&&a[i]<360){
			var ag=a[i]-270;
			var pox=-1;
			var poy=1;
			}
		if(a[i]>=180&&a[i]<270){
			var ag=270-a[i];
			var pox=-1;
			var poy=-1;
			}
		if(a[i]>=90&&a[i]<180){
			var ag=a[i]-90;
			var pox=1;
			var poy=-1;
			}

			direct[i]=[];


		for (var k=0; k < d.length; k++) {

			var prx=Math.cos(deg2rad(ag))*d[k];	//projection to axis x
			var pry=Math.sin(deg2rad(ag))*d[k];	//projection to axis y

			var lon2=(lon*lengthLonKm)+(pox*prx);	//get coord x in km
			var lat2=(lat*111.3)+(poy*pry);	//get coord y in km

			// var lon2=Math.round((lon2/lengthLonKm),5);	//transform coord x to degrees
			// var lat2=Math.round((lat2/111.3),5);	//get coord x to degrees

			lon2=lon2/lengthLonKm;	//transform coord x to degrees
			lat2=lat2/111.3;	//get coord x to degrees

			lon2=lon2.toFixed(5);
			lat2=lat2.toFixed(5);

			if(String(lat2).indexOf('e')>-1){lat2=0;}
			if(String(lon2).indexOf('e')>-1){lon2=0;}

			// locations += lat2 + ',' + lon2 + ' | '

			direct[i][k]=[];

			direct[i][k]['lat']=lat2;	//point degree y
			direct[i][k]['lon']=lon2;	//point degree x

			// coordsResult[0]=lat2;
			// coordsResult[1]=lon2;

			locations += direct[i][k]['lat'] + ',' + direct[i][k]['lon'] + ',';	//gather locations massive for request to google.maps.api

		}

	}

	console.log(locations)
	return direct;

}



function getElevation(locations,direct){
	$.getJSON('https://maps.googleapis.com/maps/api/elevation/json?locations='+locations+'&sensor=true_or_false&key=AIzaSyAHoXPmY0l3xMio4m7v3adYrIiLkkHA6sA', function(data){
		if(data.status=='OK'){
			for (var i = 0; i < direct.length; i++) {
				direct=data.results.i.elevation;
			};
		}
	});
}

// https://maps.googleapis.com/maps/api/elevation/json?locations='.$locations2.'&sensor=true_or_false&key=AIzaSyAHoXPmY0l3xMio4m7v3adYrIiLkkHA6sA


// map.data.loadGeoJson('https://maps.googleapis.com/maps/api/elevation/json?locations=49.52,23.35&sensor=true_or_false&key=AIzaSyAHoXPmY0l3xMio4m7v3adYrIiLkkHA6sA');




function initMap() {

	var currentLocation=localStorage.getItem('currentLocation');
	if(currentLocation){
		var coords=currentLocation.split(',');
		var lat=coords[0]*1;
		var lon=coords[1]*1;
	}else{
		var gmmLastCoords=getCookie('gmm_last_coords');
		if(gmmLastCoords){
			var coords=gmmLastCoords.split(',');
			var lat=coords[0]*1;
			var lon=coords[1]*1;
		}else{
			var lat=48.8566140;
			var lon=2.3522219;
		}
	}

	var markers=[];
	var centerPosition=new google.maps.LatLng(lat,lon);

	var map = new google.maps.Map(document.getElementById('map'), {
		zoom: 16,
		minZoom: 2,
		maxZoom: 19,
		center: centerPosition,

		//--------------------------------- STYLE --------- START ----------
		disableDefaultUI: true,
		mapTypeControl: true,
		mapTypeControlOptions: {
				style: google.maps.MapTypeControlStyle.DEFAULT,
				position: google.maps.ControlPosition.RIGHT_TOP
			},
		zoomControl: true,
		scaleControl: true, // delete tests after
		zoomControlOptions: {
					style: google.maps.ZoomControlStyle.SMALL,
					position: google.maps.ControlPosition.RIGHT_BOTTOM
				},
		styles: [
			{
					"stylers": [
							{
									"saturation": -100
							}
					]
			},
			{
					"featureType": "water",
					"elementType": "geometry.fill",
					"stylers": [
							{
									"color": "#0099dd"
							}
					]
			},
			{
					"featureType": "poi.park",
					"elementType": "geometry.fill",
					"stylers": [
							{
									"color": "#aadd55"
							}
					]
			},
			{
					"featureType": "road.highway",
					"elementType": "labels",
					"stylers": [
							{
									"visibility": "on"
							}
					]
			},
			{
					"featureType": "road.arterial",
					"elementType": "labels.text",
					"stylers": [
							{
									"visibility": "on"
							}
					]
			},
			{
					"featureType": "road.local",
					"elementType": "labels.text",
					"stylers": [
							{
									"visibility": "on"
							}
					]
			},
			{}
		]
	});

	// var image={
	// 	url: "https://getmeteo.me/style/img/piker_orange.svg",
	// 	size: new google.maps.Size(161, 272),
	// 	origin: new google.maps.Point(0, 0),
	// 	anchor: new google.maps.Point(12, 42),
	// 	scaledSize: new google.maps.Size(25, 42),
	// 	// labelOrigin: new google.maps.Point(12, 40)	// need for our text
	// };

	var markerData = '+7&deg;C';


	var zoomScaleControl={
		19:0,
		18:0,
		17:0,
		16:1,
		15:2,
		14:3,
		13:4,
		12:5,
		11:6,
		10:7,
		9:8,
		8:9,
		7:10,
		6:11,
		5:12,
		4:13,
		3:14,
		2:15
	};

	addMarker(centerPosition);

	var bounds  = new google.maps.LatLngBounds();
	// loc = new google.maps.LatLng(marker.position.lat(), marker.position.lng());
	// bounds.extend(centerPosition);
	// map.fitBounds(bounds);       // auto-zoom
	// map.panToBounds(bounds);     // auto-center

	var pointNet=coordsCalculate(lat,lon);

	for (var i = 0; i < pointNet.length; i++) {
		var pointLat = +pointNet[i][zoomScaleControl[map.getZoom()]]['lat'];
		// var pointLat = +pointNet[i][1]['lat'];
		var pointLon = +pointNet[i][zoomScaleControl[map.getZoom()]]['lon'];
		// var pointLon = +pointNet[i][1]['lon'];

		// var positionNet = {lat: pointLat, lng: pointLon};
		var positionNet = new google.maps.LatLng(pointLat,pointLon);

		bounds.extend(positionNet);

		addMarker(positionNet);
	}

	map.fitBounds(bounds);
    map.panToBounds(bounds);


	map.addListener('click', function(e) {
		map.panTo(e.latLng);	//position to center

		deleteMarkers();

		// Create a marker for each place.
		addMarker(e.latLng);

		var pointNet=coordsCalculate(e.latLng.lat(),e.latLng.lng());

		for (var i = 0; i < pointNet.length; i++) {
			var pointLat = +pointNet[i][zoomScaleControl[map.getZoom()]]['lat'];
			var pointLon = +pointNet[i][zoomScaleControl[map.getZoom()]]['lon'];

			// var positionNet = {lat: pointLat, lng: pointLon};
			var positionNet = new google.maps.LatLng(pointLat,pointLon);


			addMarker(positionNet);
		}

		lat = e.latLng.lat().toFixed(5);
		lon = e.latLng.lng().toFixed(5);

		// alert(map.getZoom()); // delete tests after

		// setUrl(lat+','+lon);

	});



	map.addListener('zoom_changed', function() {
		// map.panTo({lat: +lat, lng: +lon});
		map.panTo(new google.maps.LatLng(lat,lon));

		deleteMarkers();

		// var position = {lat: +lat, lng: +lon};
		var position = new google.maps.LatLng(lat,lon);

		addMarker(position);


		var pointNet=coordsCalculate(lat,lon);

		for (var i = 0; i < pointNet.length; i++) {
			var pointLat = +pointNet[i][zoomScaleControl[map.getZoom()]]['lat'];
			var pointLon = +pointNet[i][zoomScaleControl[map.getZoom()]]['lon'];

			// var positionNet = {lat: pointLat, lng: pointLon};
			var positionNet = new google.maps.LatLng(+pointLat,+pointLon);

			addMarker(positionNet);
		}

		// alert(map.getZoom()); // delete tests after
	});




	// http://stackoverflow.com/questions/32467212/google-maps-marker-label-with-multiple-characters
	// https://habrahabr.ru/post/131654/
	// https://googlegeodevelopers.blogspot.com/2015/08/labels-meets-markers-with-google-maps.html
	// http://humaan.com/custom-html-markers-google-maps/
	// Adds a marker to the map and push to the array.
	function addMarker(location) {
		// var marker = new google.maps.Marker({
		// 	position: location,
		// 	map: map,
		// 	icon: image,
		// 	content: '<strong>+++</strong>',
		// 	title: 'fff'+'\n'+'ggg',

		// 	label: {
		// 		text: '+2°C'+'<br/>'+'ff',
		// 		color: '#3399ff',
		// 		// context: '<strong>+++</strong>'
		// 		// html: '<strong>+++</strong>'
		// 	},
		// 	// labelClass: "labels", // the CSS class for the label
		// });

		var marker = new CustomMarker(
			location,
			map,
			markerData
		);
		markers.push(marker);
	}

	// Sets the map on all markers in the array.
	function setMapOnAll(map) {
		for (var i = 0; i < markers.length; i++) {
			markers[i].setMap(map);
		}
	}

	// Removes the markers from the map, but keeps them in the array.
	function clearMarkers() {
		setMapOnAll(null);
	}

	// Shows any markers currently in the array.
	function showMarkers() {
		setMapOnAll(map);
	}

	// Deletes all markers in the array by removing references to them.
	function deleteMarkers() {
		clearMarkers();
		markers = [];
	}

























}



//-----------------------------------------------------------------



// function CustomMarker(latlng, map, args) {
function CustomMarker(latlng, map, markerData){
	this.latlng = latlng;
	this.setMap(map);
	this.markerData = markerData;
}

CustomMarker.prototype = new google.maps.OverlayView();

CustomMarker.prototype.draw = function() {
	
	var self = this;
	
	var div = this.div;
	
	if (!div) {
	
		div = this.div = document.createElement('div');
		div.innerHTML=this.markerData;
		
		div.className = 'marker-gmm-forecast';
		
		div.style.position = 'absolute';
		// div.style.cursor = 'pointer';
		// div.style.width = '40px';
		// div.style.height = '40px';
		// div.style.background = '#0277bd';
		// div.style.borderRadius = '50%';
		// div.style.padding = '10px';
		// div.style.boxSizing = 'border-box';


		
		// if (typeof(self.args.marker_id) !== 'undefined') {
		// 	div.dataset.marker_id = self.args.marker_id;
		// }
		
		// google.maps.event.addDomListener(div, "click", function(event) {
		// 	alert('You clicked on a custom marker!');			
		// 	google.maps.event.trigger(self, "click");
		// });
		
		var panes = this.getPanes();
		panes.overlayImage.appendChild(div);
	}
	
	var point = this.getProjection().fromLatLngToDivPixel(this.latlng);
	
	if (point) {
		div.style.left = (point.x - 10) + 'px';
		div.style.top = (point.y - 20) + 'px';
	}
};

CustomMarker.prototype.remove = function() {
	if (this.div) {
		this.div.parentNode.removeChild(this.div);
		this.div = null;
	}	
};

CustomMarker.prototype.getPosition = function() {
	return this.latlng;	
};



//-----------------------------------------------------------------











google.maps.event.addDomListener(window, 'load', initMap);


</script>



<script src="//code.jquery.com/jquery-2.2.1.min.js"></script>



</body>
</html>